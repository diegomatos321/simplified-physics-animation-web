import{d as L,r as E,o as W,c as F,a as t,t as h,w,v as I,u as g,i as x,b as J,e as D,f as K}from"./index-DHBAdLQJ.js";import{T as Y,G as H,p as Q,c as X,f as T,S as Z,_ as $,a as k,Y as ee,A as te,g as _,r as C}from"./SceneThreaded-DWFxNHy2.js";const se={style:{"max-width":"1000px"},class:"mx-auto space-y-4"},oe={class:"w-full flex flex-col md:flex-row gap-6"},ne={class:"md:w-1/3 border border-slate-200 rounded p-4 space-y-2"},le={class:"flex justify-between"},ie={class:"flex justify-between"},ae=["disabled"],re={class:"flex justify-between"},de={class:"flex justify-between"},ue={class:"flex justify-between"},fe={class:"flex justify-between"},ce={class:"flex justify-between"},pe={class:"flex justify-between"},me={class:"flex flex-wrap justify-between mt-4"},ge=["disabled"],a=600,V=300,he=L({__name:"PolygonChaos",setup(ye){let b=!1,u=100,M=0,p=Y.Naive,m=H.Sat,f=!0;const S=E(0),j=a**2;let c=Math.sqrt(j/(u*3)),n=null,P=0,r=null;const v=E(null);let y=null;function U(){if(!(!v.value||b)){if(b=!0,y===null){const s=e=>{e.setup=()=>z(e),e.draw=()=>A(e)};y=new Q(s)}f&&(r=X(),r.addEventListener("message",B))}}async function z(s){if(v.value!==null)if(s.createCanvas(a,a).parent(v.value),f&&r){n=new k;const e={type:"start",config:{worldBoundings:{top:[0,0],right:[a,a]},BroadPhase:p,CollisionDetection:m,gravity:T(0,98,0),gridSize:c}};r.postMessage(e)}else n=new Z(new $({worldBoundings:{top:[0,0],right:[a,a]},BroadPhase:p,CollisionDetection:m,gravity:T(0,98,0),gridSize:c}))}function A(s){if(n){for(P+=s.deltaTime;M<u&&P>=V;)G(),P-=V;s.background("#ffffff"),s.push(),s.stroke("#e0e0e0"),s.strokeWeight(1);for(let e=0;e<=s.width;e+=c)s.line(e+.5,0,e+.5,s.height);for(let e=0;e<=s.height;e+=c)s.line(0,e+.5,s.width,e+.5);s.pop(),S.value=Math.round(s.frameRate()),n.step(s.deltaTime/1e3),n.render(s)}}W(()=>{console.log("Clean up"),y&&(y.remove(),y=null),r&&(r.removeEventListener("message",B),r.terminate(),r=null)});function G(){if(n)if(f&&n instanceof k){const s=Math.random()*a,e=Math.random()*a,o=Math.random(),d=Math.random()<.2,l=c;let i;o<=.25?i={type:C.Triangle,x:s,y:e,size:l,isStatic:d}:o<=.5?i={type:C.Rectangle,x:s,y:e,width:l,height:l/2,isStatic:d}:o<=.75?i={type:C.Polygon,x:s,y:e,size:l,k:5,isStatic:d}:i={type:C.Polygon,x:s,y:e,size:l,k:6,isStatic:d},r?.postMessage({type:"add_object",obj:i}),M++}else{const s=Math.random()*a,e=Math.random()*a,o=Math.random(),d=Math.random()<.2,l=c;let i;o<=.25?i=new ee(s,e,l,d):o<=.5?i=new te(s,e,l,l/2,d):o<=.75?i=_.PolygonBuilder(s,e,l,5,d):i=_.PolygonBuilder(s,e,l,6,d),n.add(i),M++}}function N(){return n?n.getParticlesCount():0}function O(){return n?n.getConstraintsCount():0}function R(){return n?n.getCollisionsCount():0}function q(){c=Math.sqrt(j/(u*3))}function B(s){if(!n||!(n instanceof k))return;const e=s.data;e.type==="simulation_state"&&(n.simulation_state=e.state)}return(s,e)=>(K(),F("div",se,[e[15]||(e[15]=t("div",null,[t("h1",{class:"text-3xl"},[t("strong",null,"Polygon Chaos")]),t("p",null,"Polygons vs Polygons demo")],-1)),t("div",oe,[t("div",{class:"md:w-2/3",ref_key:"sketchContainer",ref:v},null,512),t("div",ne,[t("div",le,[e[4]||(e[4]=t("p",null,"FPS",-1)),t("p",null,h(S.value),1)]),t("div",ie,[e[5]||(e[5]=t("label",{for:"totalEntities"},"Entities",-1)),w(t("input",{id:"totalEntities",class:"border border-slate-200 rounded text-right",type:"number",step:"1","onUpdate:modelValue":e[0]||(e[0]=o=>x(u)?u.value=o:u=o),disabled:g(b),onChange:q},null,40,ae),[[I,g(u)]])]),t("div",re,[e[6]||(e[6]=t("p",null,"Particles",-1)),t("p",null,h(N()),1)]),t("div",de,[e[7]||(e[7]=t("p",null,"Constraints",-1)),t("p",null,h(O()),1)]),t("div",ue,[e[8]||(e[8]=t("p",null,"Collision Tests",-1)),t("p",null,h(R()),1)]),e[14]||(e[14]=t("hr",{class:"my-4 border-slate-200"},null,-1)),t("div",fe,[e[9]||(e[9]=t("label",{for:"threaded"},"Threaded Mode",-1)),w(t("input",{id:"threaded",name:"threaded",type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>x(f)?f.value=o:f=o)},null,512),[[J,g(f)]])]),t("div",ce,[e[11]||(e[11]=t("label",{for:"broadPhaseMode"},"Broad Phase",-1)),w(t("select",{style:{"max-width":"100px"},name:"broadPhaseMode",id:"broadPhaseMode","onUpdate:modelValue":e[2]||(e[2]=o=>x(p)?p.value=o:p=o),class:"border border-slate-200 rounded"},[...e[10]||(e[10]=[t("option",{value:"0"},"Naive",-1),t("option",{value:"1"},"Grid Spatial Partition",-1)])],512),[[D,g(p)]])]),t("div",pe,[e[13]||(e[13]=t("label",{for:"collisionDetectionMode"},"Collision Detection",-1)),w(t("select",{style:{"max-width":"100px"},name:"collisionDetectionMode",id:"collisionDetectionMode","onUpdate:modelValue":e[3]||(e[3]=o=>x(m)?m.value=o:m=o),class:"border border-slate-200 rounded"},[...e[12]||(e[12]=[t("option",{value:"0"},"GJK/EPA",-1),t("option",{value:"1"},"Sat",-1)])],512),[[D,g(m)]])]),t("div",me,[t("button",{class:"w-full px-4 py-2 border rounded",onClick:U,disabled:g(b)},"Start",8,ge)])])])]))}});export{he as default};
